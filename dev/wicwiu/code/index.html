


<!doctype html>
<html lang="kr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="HGU DL Lab">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.3">
    
    
      
        <title>4. WICWIU 코드 같이보기 - WICWIU</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.947af8d5.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.7f672a1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../stylesheets/gradient-dark.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#project-layout" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="WICWIU" class="md-header-nav__button md-logo" aria-label="WICWIU">
      
  <img src="../../../assets/images/favicon.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            WICWIU
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              4. WICWIU 코드 같이보기
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="검색" placeholder="검색" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/WICWIU/WICWIU/" title="저장소로 이동" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    WICWIU
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="WICWIU" class="md-nav__button md-logo" aria-label="WICWIU">
      
  <img src="../../../assets/images/favicon.png" alt="logo">

    </a>
    WICWIU
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/WICWIU/WICWIU/" title="저장소로 이동" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    WICWIU
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      WICWIU 개발 가이드
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="WICWIU 개발 가이드" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        WICWIU 개발 가이드
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" checked>
    
    <label class="md-nav__link" for="nav-4-1">
      WICWIU
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="WICWIU" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        WICWIU
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/" title="1. About WICWIU" class="md-nav__link">
      1. About WICWIU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nn/" title="2. WICWIU 신경망 구성" class="md-nav__link">
      2. WICWIU 신경망 구성
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../learn/" title="3. WICWIU 로 학습하기" class="md-nav__link">
      3. WICWIU 로 학습하기
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        4. WICWIU 코드 같이보기
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="4. WICWIU 코드 같이보기" class="md-nav__link md-nav__link--active">
      4. WICWIU 코드 같이보기
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="목차">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      목차
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    Project layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wicwiu" class="md-nav__link">
    WICWIU 코드 살펴보기
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-src" class="md-nav__link">
    Compile src/
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-tutorialsimagenet" class="md-nav__link">
    Compile tutorials/ImageNet/
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsmnist" class="md-nav__link">
    Tutorials tutorials/MNIST
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/MNIST">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsmnistnetmy_cnnhpp" class="md-nav__link">
    tutorials/MNIST/net/my_CNN.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsmnistmaincpp" class="md-nav__link">
    tutorials/MNIST/main.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsimagenet-resnet" class="md-nav__link">
    Tutorials tutorials/ImageNet (ResNet)
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/ImageNet (ResNet)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsimagenetnetmy_resnethpp" class="md-nav__link">
    tutorials/ImageNet/net/my_Resnet.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsimagenetmaincpp" class="md-nav__link">
    tutorials/ImageNet/main.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsimagenet-densenet" class="md-nav__link">
    Tutorials tutorials/ImageNet (DenseNet)
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/ImageNet (DenseNet)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsimagenetnetmy_densenethpp" class="md-nav__link">
    tutorials/ImageNet/net/my_Densenet.hpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsganvanillagan" class="md-nav__link">
    Tutorials tutorials/GAN/VanillaGAN
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/GAN/VanillaGAN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillagannetmy_generatorhpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/net/my_Generator.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillagannetmy_discriminatorhpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/net/my_Discriminator.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillagannetmy_ganhpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/net/my_GAN.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillaganmaincpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/main.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Git
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Git" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Git
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/git/" title="Collaborate with Git" class="md-nav__link">
      Collaborate with Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/message/" title="Commit/PR protocol" class="md-nav__link">
      Commit/PR protocol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/update/" title="Update forked repo" class="md-nav__link">
      Update forked repo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      GPU Acceleration
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="GPU Acceleration" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        GPU Acceleration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../GPU/cuda/" title="cuda" class="md-nav__link">
      cuda
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Makefile
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Makefile" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Makefile
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../makefile/makefile/" title="Makefile 기본" class="md-nav__link">
      Makefile 기본
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../makefile/makefile2/" title="Makefile 고급" class="md-nav__link">
      Makefile 고급
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      CLI
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="CLI" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/cli/" title="CLI" class="md-nav__link">
      CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/zsh/" title="zsh" class="md-nav__link">
      zsh
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/tmux/" title="tmux" class="md-nav__link">
      tmux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      WICWIU 분석
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="WICWIU 분석" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        WICWIU 분석
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      fewshot diary
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="fewshot diary" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        fewshot diary
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../doit/fewshot/step1-1/" title="Step 1 (1). Data → Tensor" class="md-nav__link">
      Step 1 (1). Data &rarr; Tensor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../doit/fewshot/step1-2/" title="Step 1 (2). Data → Tensor" class="md-nav__link">
      Step 1 (2). Data &rarr; Tensor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../doit/fewshot/step2/" title="Step 2. 순전파" class="md-nav__link">
      Step 2. 순전파
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../doit/fewshot/step3/" title="Step 3. 역전파" class="md-nav__link">
      Step 3. 역전파
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../doit/fewshot/step4/" title="Step 4. 최적화" class="md-nav__link">
      Step 4. 최적화
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      이곳에 문서 작성하기
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="이곳에 문서 작성하기" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        이곳에 문서 작성하기
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/markdown/" title="Step 1. Markdown 파일" class="md-nav__link">
      Step 1. Markdown 파일
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/code/" title="Step 2. 소스코드 설명하기" class="md-nav__link">
      Step 2. 소스코드 설명하기
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/format/" title="Step 3. 고오급 포매팅" class="md-nav__link">
      Step 3. 고오급 포매팅
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/admonitions/" title="Step 4. Admonitions" class="md-nav__link">
      Step 4. Admonitions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/tab/" title="Step 5. 컨텐츠 탭" class="md-nav__link">
      Step 5. 컨텐츠 탭
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/button/" title="Step 6. 버튼 넣기" class="md-nav__link">
      Step 6. 버튼 넣기
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/math/" title="Step 7. 수식 보여주기" class="md-nav__link">
      Step 7. 수식 보여주기
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../write/api/" title="Step 8. API 작성" class="md-nav__link">
      Step 8. API 작성
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="목차">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      목차
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    Project layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wicwiu" class="md-nav__link">
    WICWIU 코드 살펴보기
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-src" class="md-nav__link">
    Compile src/
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-tutorialsimagenet" class="md-nav__link">
    Compile tutorials/ImageNet/
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsmnist" class="md-nav__link">
    Tutorials tutorials/MNIST
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/MNIST">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsmnistnetmy_cnnhpp" class="md-nav__link">
    tutorials/MNIST/net/my_CNN.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsmnistmaincpp" class="md-nav__link">
    tutorials/MNIST/main.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsimagenet-resnet" class="md-nav__link">
    Tutorials tutorials/ImageNet (ResNet)
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/ImageNet (ResNet)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsimagenetnetmy_resnethpp" class="md-nav__link">
    tutorials/ImageNet/net/my_Resnet.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsimagenetmaincpp" class="md-nav__link">
    tutorials/ImageNet/main.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsimagenet-densenet" class="md-nav__link">
    Tutorials tutorials/ImageNet (DenseNet)
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/ImageNet (DenseNet)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsimagenetnetmy_densenethpp" class="md-nav__link">
    tutorials/ImageNet/net/my_Densenet.hpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tutorials-tutorialsganvanillagan" class="md-nav__link">
    Tutorials tutorials/GAN/VanillaGAN
  </a>
  
    <nav class="md-nav" aria-label="Tutorials tutorials/GAN/VanillaGAN">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillagannetmy_generatorhpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/net/my_Generator.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillagannetmy_discriminatorhpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/net/my_Discriminator.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillagannetmy_ganhpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/net/my_GAN.hpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tutorialsganvanillaganmaincpp" class="md-nav__link">
    tutorials/GAN/VanillaGAN/main.cpp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/WICWIU/WICWIU/edit/master/docs/dev/wicwiu/code.md" title="이 페이지를 편집" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                  <h1>4. WICWIU 코드 같이보기</h1>
                
                <p>이곳에서는 이전에 설명한 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 로 신경망을 구성하고, <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 로 딥러닝을 하는 것을 코드로 함께 보면서 이해해보겠습니다.</p>
<p>먼저 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 의 레이아웃을 다시 살펴보겠습니다.</p>
<h2 id="project-layout">Project layout<a class="headerlink" href="#project-layout" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 는 크게 <code>lib/</code>, <code>tutorials/</code>, <code>src/</code> 로 구성되어 있습니다. 세부 디렉토리에 대한 설명은 다음과 같습니다.</p>
<pre><code>lib/                # 컴파일 후 정적 라이브러리가 생성되는 디렉토리.

tutorials/          # WICWIU 로 제작된 여러 신경망을 학습해볼 수 있는 코드들.
                    # net/ 하위 디렉토리에 사전에 정의된 인공신경망이 있습니다.
                    # data/ 하위 디렉토리에 인공신경망이 학습할 데이터셋이 있습니다.
    CIFAR10/
    CIFAR100Reader/
    ImageNet/       # 포함된 파일을 이용하여 사전에 정의된 인공신경망을 학습 가능.
    MNIST/          # 포함된 파일을 이용하여 사전에 정의된 인공신경망을 학습 가능.
    GAN/            # 하위 디렉토리 내 포함된 파일을 이용하여 사전에
                    # 정의된 인공신경망을 학습할 수 있습니다.
        VanillaGAN/
        DCGAN/
        WGAN/
        BEGAN/

src/                # LossFunction, Operator, Optimizer, 그리고 Module
                    # 을 비롯한 소스파일이 있는 디렉토리.
    LossFunction/
    Operator/
    Optimizer/
    Module/
</code></pre>
<h2 id="wicwiu">WICWIU 코드 살펴보기<a class="headerlink" href="#wicwiu" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>makefile</code> 의 문법에 대한 기초가 부족하다면 <a href="../../makefile/makefile/">Makefile 기초 문법</a> 를 참고하세요!</p>
</div>
<h2 id="compile-src">Compile <code>src/</code><a class="headerlink" href="#compile-src" title="Permanent link">&para;</a></h2>
<p><code>src/</code> 는 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 라이브러리 디렉토리입니다. 이것을 컴파일하는 <code>makefile</code> 를 같이 살펴보겠습니다.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 는 계속 업데이트 되고 있기 때문에 최신 버전의 소스코드와 다를 수도 있습니다.</p>
</div>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/makefile"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">.SUFFIXES</span> <span class="o">=</span> .cpp .o

<span class="nv">FRAMEWORK_LIB</span> <span class="o">=</span> lib/library.a
<span class="nv">CFLAGS</span> <span class="o">=</span> -O2 -std<span class="o">=</span>c++11

<span class="nv">ENABLE_CUDNN</span> <span class="o">=</span> -D__CUDNN__
<span class="nv">DFLAGS</span> <span class="o">=</span> -g -D__DEBUG__
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>1</strong> : </p>
<p><code>Suffix</code>, <code>CPP</code> 파일을 Object 파일로 변환시켜주는 내장 규칙입니다.</p>
</li>
<li>
<p><strong>3</strong> :</p>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 의 정적 라이브러리입니다.</p>
</li>
<li>
<p><strong>4</strong> :</p>
<p>컴파일 옵션입니다.</p>
</li>
<li>
<p><strong>6</strong> :</p>
<p>cuDNN 사용 여부 플래그입니다. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>cuDNN 미 설치 및 미 사용 시 주석처리를 해야합니다.</p>
</div>
</li>
<li>
<p><strong>7</strong> : </p>
<p>디버그 코드 사용 여부 플래그입니다. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>미 사용 시 주석처리를 해야합니다.</p>
</div>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">INCLUDE_PATH</span> <span class="o">=</span> -I/usr/local/cuda/include
<span class="nv">LIB_PATH</span> <span class="o">=</span> -L. -L/usr/local/cuda/lib64

<span class="nv">CC</span> <span class="o">=</span> g++
<span class="nv">NVCC</span> <span class="o">=</span> nvcc

<span class="cp">ifdef   ENABLE_CUDNN</span>
    <span class="nv">LINKER</span> <span class="o">=</span> nvcc
    <span class="nv">LFLAGS</span> <span class="o">=</span> -lcudart -lcudnn -lpthread
<span class="cp">else</span>
    <span class="nv">LINKER</span> <span class="o">=</span> g++
    <span class="nv">LFLAGS</span> <span class="o">=</span> -lpthread
<span class="cp">endif</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>9</strong> :</p>
<p>전처리 과정에서 CUDA 헤더 파일을 탐색할 디렉토리를 설정합니다.</p>
</li>
<li>
<p><strong>10</strong> :</p>
<p>CUDA 라이브러리를 탐색할 디렉토리를 설정합니다.</p>
</li>
<li>
<p><strong>12</strong> :</p>
<p>컴파일러를 정의합니다.</p>
</li>
<li>
<p><strong>13</strong> :</p>
<p>CUDA 파일 용 컴파일러를 정의합니다.</p>
</li>
<li>
<p><strong>15~21</strong> :</p>
<p>cuDNN 사용 시, NVCC 링커 사용 및 <code>cudart</code>, <code>cudnn</code>, <code>pthread</code> 라이브러리를 사용합니다.</p>
<p>cuDNN 미 사용 시, <code>g++</code> 링커 사용 및 <code>pthread</code> 라이브러리를 사용합니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">AR</span> <span class="o">=</span> ar

<span class="nv">SRCS</span> <span class="o">=</span> <span class="se">\</span>
    src/Utils.cpp   <span class="se">\</span>
    src/Shape.cpp   <span class="se">\</span>

<span class="nv">OBJS</span> <span class="o">=</span> <span class="si">${</span><span class="nv">SRCS</span><span class="p">:.cpp=.o</span><span class="si">}</span>

<span class="cp">ifdef   ENABLE_CUDNN</span>
    <span class="nv">CUDA_SRCS</span> <span class="o">=</span> <span class="se">\</span>
        src/Utils_CUDA.cu <span class="se">\</span>
        src/Optimizer/AdamOptimizer_CUDA.cu <span class="se">\</span>
        src/Operator/Concatenate_CUDA.cu

    <span class="nv">CUDA_OBJS</span> <span class="o">=</span> <span class="si">${</span><span class="nv">CUDA_SRCS</span><span class="p">:.cu=.o</span><span class="si">}</span>
<span class="cp">endif</span>

<span class="nf">all</span><span class="o">:</span>    <span class="k">$(</span><span class="nv">FRAMEWORK_LIB</span><span class="k">)</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>25~27</strong> :</p>
<p><code>.cpp</code> 소스 코드 파일을 정의합니다.</p>
</li>
<li>
<p><strong>29</strong> :</p>
<p><code>SRCS</code> 의 <code>.cpp</code> 파일을 각각 컴파일해 <code>.o</code> 파일(오브젝트 파일)들을 생성합니다.</p>
</li>
<li>
<p><strong>31~38</strong> :</p>
<p>cuDNN 사용 시, <code>CUDA_SRC/</code> 의 <code>.cu</code> 파일을 각각 컴파일해 <code>.o</code> 파일들을 생성합니다.</p>
</li>
<li>
<p><strong>40</strong> : </p>
<p>컴파일 시작 타겟입니다. <code>FRAMEWORK_LIB</code> 의 의존성을 확인합니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nf">.cpp.o</span><span class="o">:</span>
    <span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>DFLAGS<span class="k">)</span> <span class="k">$(</span>ENABLE_CUDNN<span class="k">)</span> <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> <span class="k">$(</span>LIB_PATH<span class="k">)</span> -c $&lt; -o <span class="nv">$@</span>

<span class="nf">src/Utils_CUDA.o</span><span class="o">:</span> <span class="n">src</span>/<span class="n">Utils_CUDA</span>.<span class="n">cu</span>
    <span class="k">$(</span>NVCC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>DFLAGS<span class="k">)</span> <span class="k">$(</span>ENABLE_CUDNN<span class="k">)</span> <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> -c $&lt; -o <span class="nv">$@</span>
<span class="nf">src/Optimizer/AdamOptimizer_CUDA.o</span><span class="o">:</span> <span class="n">src</span>/<span class="n">Optimizer</span>/<span class="n">AdamOptimizer_CUDA</span>.<span class="n">cu</span>
    <span class="k">$(</span>NVCC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>DFLAGS<span class="k">)</span> <span class="k">$(</span>ENABLE_CUDNN<span class="k">)</span> <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> -c $&lt; -o <span class="nv">$@</span>
<span class="nf">src/Operator/Concatenate_CUDA.o</span><span class="o">:</span> <span class="n">src</span>/<span class="n">Operator</span>/<span class="n">Concatenate_CUDA</span>.<span class="n">cu</span>
    <span class="k">$(</span>NVCC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>DFLAGS<span class="k">)</span> <span class="k">$(</span>ENABLE_CUDNN<span class="k">)</span> <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> -c $&lt; -o <span class="nv">$@</span>

<span class="nf">$(FRAMEWORK_LIB)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJS</span><span class="k">)</span> <span class="k">$(</span><span class="nv">CUDA_OBJS</span><span class="k">)</span>
    <span class="k">$(</span>AR<span class="k">)</span> rcs <span class="nv">$@</span> <span class="k">$(</span>OBJS<span class="k">)</span> <span class="k">$(</span>CUDA_OBJS<span class="k">)</span>

<span class="nf">clean</span><span class="o">:</span>
    rm -rf *.o <span class="k">$(</span>OBJS<span class="k">)</span> <span class="k">$(</span>CUDA_OBJS<span class="k">)</span> <span class="k">$(</span>FRAMEWORK_LIB<span class="k">)</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>42~43</strong> : </p>
<p>주어진 파일을 옵션들을 이용해 컴파일하여 같은 이름의 오브젝트 파일을 생성합니다.</p>
</li>
<li>
<p><strong>45~49</strong> :</p>
<p>해당 <code>.cu</code> 파일의 의존성을 확인하고 옵션들을 이용해 컴파일하여 같은 이름의 오브젝트 파일을 생성합니다.</p>
</li>
<li>
<p><strong>52~53</strong> :</p>
<p><code>OBJS</code>, <code>CUDA_OBJS</code> 의 의존성을 확인하고, <code>FRAMEWORK_LIB</code>, <code>OBJS</code>, <code>CUDA_OBJS</code> 의 <code>.o</code> 파일들을 가지고 아카이브 파일을 만듭니다.</p>
</li>
</ul>
<hr />
<h2 id="compile-tutorialsimagenet">Compile <code>tutorials/ImageNet/</code><a class="headerlink" href="#compile-tutorialsimagenet" title="Permanent link">&para;</a></h2>
<p><code>tutorials/ImageNet/</code> 은 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 신경망 모델 예제입니다. 이것을 컴파일하는 <code>makefile</code> 를 같이 살펴보겠습니다.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 는 계속 업데이트 되고 있기 때문에 최신 버전의 소스코드와 다를 수도 있습니다.</p>
</div>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/ImageNet/makefile"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">.SUFFIXES</span> <span class="o">=</span> .cpp .o

<span class="nv">CFLAGS</span> <span class="o">=</span> -O2 -std<span class="o">=</span>c++11 -g
<span class="nv">ENABLE_CUDNN</span> <span class="o">=</span> -D__CUDNN__
<span class="nv">DFLAGS</span> <span class="o">=</span> -g -D__DEBUG__
<span class="nv">LFLAGS</span> <span class="o">=</span> -lcudart -lcudnn -lpthread -ljpeg -lturbojpeg

<span class="nv">INCLUDE_PATH</span> <span class="o">=</span> -I/usr/local/cuda/include -I/opt/libjpeg-turbo/include -I/opt/libjpeg-turbo/lib64 
<span class="nv">LIB_PATH</span> <span class="o">=</span> -L. -L/usr/local/cuda/lib64 -L/opt/libjpeg-turbo/lib64

<span class="nv">CC</span> <span class="o">=</span> g++
<span class="nv">NVCC</span> <span class="o">=</span> nvcc

<span class="nv">FRAMEWORK_LIB</span> <span class="o">=</span> ../../lib/library.a
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>6</strong> :</p>
<p>라이브러리 사용 플래그, <code>cudart</code>, <code>cudnn</code>, <code>pthread</code>, <code>jpeg</code>, <code>turbojpeg</code> 라이브러리를 사용합니다.</p>
</li>
<li>
<p><strong>8</strong> :</p>
<p>전처리 과정에서 CUDA 헤더 파일을 탐색할 디렉토리를 설정합니다.</p>
</li>
<li>
<p><strong>9</strong> :</p>
<p>CUDA 라이브러리를 탐색할 디렉토리를 설정합니다.</p>
</li>
<li>
<p><strong>14</strong> :</p>
<p>프레임워크 라이브러리 아카이브 파일을 정의합니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nv">SRCS</span> <span class="o">=</span> <span class="se">\</span>
    ../../src/Shape.cpp <span class="se">\</span>
    ../../src/LongArray.cpp <span class="se">\</span>
    ../../src/Tensor.cpp    <span class="se">\</span>
    ../../src/Operator.cpp  <span class="se">\</span>
    ../../src/LossFunction.cpp  <span class="se">\</span>
    ../../src/Optimizer.cpp <span class="se">\</span>
    ../../src/Module.cpp    <span class="se">\</span>
    ../../src/NeuralNetwork.cpp

<span class="nf">all</span><span class="o">:</span> <span class="n">main</span>

<span class="nf">.cpp.o</span><span class="o">:</span>
    <span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>DFLAGS<span class="k">)</span> <span class="k">$(</span>ENABLE_CUDNN<span class="k">)</span> <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> <span class="k">$(</span>LIB_PATH<span class="k">)</span> -c $&lt; -o <span class="nv">$@</span>

<span class="nf">main</span><span class="o">:</span> <span class="n">main</span>.<span class="n">o</span> <span class="k">$(</span><span class="nv">FRAMEWORK_LIB</span><span class="k">)</span>
    <span class="k">$(</span>NVCC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>ENABLE_CUDNN<span class="k">)</span> <span class="k">$(</span>DFLAGS<span class="k">)</span> <span class="k">$(</span>LFLAGS<span class="k">)</span> <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> <span class="k">$(</span>LIB_PATH<span class="k">)</span> -o <span class="nv">$@</span> <span class="k">$(</span>FRAMEWORK_LIB<span class="k">)</span> main.o

<span class="nf">$(FRAMEWORK_LIB)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SRC</span><span class="k">)</span>
    make -C ../..

<span class="nf">clean</span><span class="o">:</span>
    rm -rf *.o main

<span class="nf">clean_all</span><span class="o">:</span>
    rm -rf *.o main
    make clean -C ../..
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>17~25</strong> : </p>
<p><code>.cpp</code> 소스 코드 파일, 아카이브 파일의 의존성 확인을 위해 정의하는 변수입니다.</p>
</li>
<li>
<p><strong>27</strong> :</p>
<p>시작 타겟, <code>main</code> 파일의 의존성을 확인합니다.</p>
</li>
<li>
<p><strong>29~30</strong> :</p>
<p>주어진 파일을 옵션들을 이용해 컴파일하여 같은 이름의 오브젝트 파일을 생성합니다.</p>
</li>
<li>
<p><strong>32~33</strong> :</p>
<p><code>main.o</code> 파일과 <code>FRAMEWORK_LIB</code> 의 의존성을 확인하고,  옵션들을 이용해 <code>FRAMEWORK_LIB</code> 과 <code>main.o</code> 파일을 <code>main</code> 파일로 링크한다.</p>
</li>
<li>
<p><strong>35~36</strong> :</p>
<p>지정된 경로에서 <code>make</code> 실행</p>
</li>
</ul>
<hr />
<h2 id="tutorials-tutorialsmnist">Tutorials <code>tutorials/MNIST</code><a class="headerlink" href="#tutorials-tutorialsmnist" title="Permanent link">&para;</a></h2>
<p><code>tutorials/MNIST</code> 는 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 신경망 모델 예제입니다.</p>
<h3 id="tutorialsmnistnetmy_cnnhpp"><code>tutorials/MNIST/net/my_CNN.hpp</code><a class="headerlink" href="#tutorialsmnistnetmy_cnnhpp" title="Permanent link">&para;</a></h3>
<p><code>tutorials/MNIST/net/my_CNN.hpp</code> 는 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 에서 <strong>CNN</strong> 으로 MNIST 데이터셋을 학습하기 위한 인공신경망을 구성하는 예제입니다. MNIST 튜토리얼의 신경망 모델은 다음과 같이 정의됩니다. </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 는 계속 업데이트 되고 있기 때문에 최신 버전의 소스코드와 다를 수도 있습니다.</p>
</div>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/MNIST/net/my_CNN.hpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">my_CNN</span> <span class="o">:</span> <span class="k">public</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">my_CNN</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">label</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SetInput</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReShape</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="s">&quot;Flat2Image&quot;</span><span class="p">);</span>

        <span class="c1">// ======================= layer 1=======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;Conv_1&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;BN_1&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Relu_1&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Maxpooling2D</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;MaxPool_1&quot;</span><span class="p">);</span>

        <span class="c1">// ======================= layer 2=======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;Conv_2&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;BN_2&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Relu_2&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Maxpooling2D</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;MaxPool_2&quot;</span><span class="p">);</span>

        <span class="c1">// ======================= layer 3=======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReShape</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="s">&quot;Image2Flat&quot;</span><span class="p">);</span>

        <span class="c1">// ======================= layer 3=======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;Fully-Connected_1&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Relu_3&quot;</span><span class="p">);</span>
        <span class="c1">//// ======================= layer 4=======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;Fully-connected_2&quot;</span><span class="p">);</span>

        <span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

        <span class="c1">// ======================= Select LossFunction Function ===================</span>
        <span class="n">SetLossFunction</span><span class="p">(</span><span class="k">new</span> <span class="n">SoftmaxCrossEntropy</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s">&quot;SCE&quot;</span><span class="p">));</span>


        <span class="c1">// ======================= Select Optimizer ===================  </span>
        <span class="n">SetOptimizer</span><span class="p">(</span><span class="k">new</span> <span class="n">RMSPropOptimizer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GetParameter</span><span class="p">(),</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1e-08</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">MINIMIZE</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">my_CNN</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>5</strong> :</p>
<p><code>SetInput</code> 함수를 통해 <span class="arithmatex">\(2\)</span> 가지 입력(<code>data</code>, <code>label</code>) 이 모델의 학습에 들어간다는 것을 명시합니다.</p>
</li>
<li>
<p><strong>9</strong> :</p>
<p><code>ReShape</code> 함수로 MNIST 손글씨 이미지 <code>x</code> 를 <code>Tensor</code> 형태로 변환합니다.</p>
</li>
<li>
<p><strong>12~30</strong> :</p>
<p><code>ConvolutionLayer2D</code>, <code>BatchNormalizeLayer</code>, <code>Relu</code>, <code>Maxpooling</code> 등의 <code>Operator</code> 들로 신경망을 구성합니다. </p>
</li>
<li>
<p><strong>35</strong> :</p>
<p><code>SetLossFunction</code> 함수로 손실함수를 정의합니다.</p>
</li>
<li>
<p><strong>39</strong> :</p>
<p><code>SetOptimizer</code> 함수로 <code>Optimizer</code> 를 정의합니다.</p>
</li>
</ul>
<h3 id="tutorialsmnistmaincpp"><code>tutorials/MNIST/main.cpp</code><a class="headerlink" href="#tutorialsmnistmaincpp" title="Permanent link">&para;</a></h3>
<p><code>tutorials/MNIST/main.cpp</code> 는 <code>tutorials/MNIST/net/my_CNN.hpp</code> 에서 정의한 인공신경망을 사용하여 MNIST 손글씨 데이터셋을 학습합니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/MNIST/main.cpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">// create input, label data placeholder -&gt; Tensorholder</span>
<span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span>     <span class="o">=</span> <span class="k">new</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">784</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">);</span>
<span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">);</span>

<span class="c1">// ======================= Select net ===================</span>
<span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">net</span> <span class="o">=</span> <span class="k">new</span> <span class="n">my_CNN</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
<span class="c1">// ======================= Prepare Data ===================</span>
<span class="n">MNISTDataSet</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MNISTDataSet</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;data/train-images-idx3-ubyte&quot;</span><span class="p">,</span> <span class="s">&quot;data/train-labels-idx1-ubyte&quot;</span><span class="p">,</span> <span class="n">TRAINING</span><span class="p">);</span>
<span class="n">DataLoader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span> <span class="n">train_dataloader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataLoader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>

<span class="n">MNISTDataSet</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MNISTDataSet</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;data/t10k-images-idx3-ubyte&quot;</span><span class="p">,</span> <span class="s">&quot;data/t10k-labels-idx1-ubyte&quot;</span><span class="p">,</span> <span class="n">TESTING</span><span class="p">);</span>
<span class="n">DataLoader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span> <span class="n">test_dataloader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataLoader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>20~21</strong> :</p>
<p><code>Tensorholder</code> (placeholder) 클래스로 손글씨 이미지와 정답레이블을 저장 할 변수를 생성합니다.</p>
</li>
<li>
<p><strong>24</strong> :</p>
<p>사전에 정의한 <code>CNN</code> 신경망을 생성합니다.</p>
</li>
<li>
<p><strong>26~30</strong> :</p>
<p>MNIST 데이터셋과 데이터로더를 생성합니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">// ======================= Train =======================</span>
<span class="kt">float</span> <span class="n">train_accuracy</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">train_avg_loss</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>

<span class="n">net</span><span class="o">-&gt;</span><span class="n">SetModeTrain</span><span class="p">();</span>

<span class="n">startTime</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">LOOP_FOR_TRAIN</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//dataset-&gt;CreateTrainDataPair(BATCH);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*&gt;</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">=</span>  <span class="n">train_dataloader</span><span class="o">-&gt;</span><span class="n">GetDataFromGlobalBuffer</span><span class="p">();</span>
    <span class="c1">// printf(&quot;%d\r\n&quot;, temp-&gt;size());</span>

    <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x_t</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">temp</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">l_t</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">temp</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">delete</span> <span class="n">temp</span><span class="p">;</span>

<span class="cp">#ifdef __CUDNN__</span>
    <span class="n">x_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span> 
    <span class="n">l_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
<span class="cp">#endif  </span><span class="c1">// __CUDNN__</span>
    <span class="c1">// std::cin &gt;&gt; temp;</span>
    <span class="n">net</span><span class="o">-&gt;</span><span class="n">FeedInputTensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_t</span><span class="p">,</span> <span class="n">l_t</span><span class="p">);</span>
    <span class="n">net</span><span class="o">-&gt;</span><span class="n">ResetParameterGradient</span><span class="p">();</span>
    <span class="n">net</span><span class="o">-&gt;</span><span class="n">Train</span><span class="p">();</span>
    <span class="c1">// std::cin &gt;&gt; temp;</span>
    <span class="n">train_accuracy</span> <span class="o">+=</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">GetAccuracy</span><span class="p">();</span>
    <span class="n">train_avg_loss</span> <span class="o">+=</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">GetLoss</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">Train complete percentage is %d / %d -&gt; loss : %f, acc : %f&quot;</span>  <span class="cm">/*(ExcuteTime : %f)*/</span><span class="p">,</span>
            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LOOP_FOR_TRAIN</span><span class="p">,</span>
            <span class="n">train_avg_loss</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">train_accuracy</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="cm">/*nProcessExcuteTime*/</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">endTime</span>            <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
<span class="n">nProcessExcuteTime</span> <span class="o">=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">))</span> <span class="o">/</span> <span class="n">CLOCKS_PER_SEC</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">(excution time per epoch : %f)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nProcessExcuteTime</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>72~77</strong>:</p>
<p>MNIST 데이터셋으로부터 이미지와 정답레이블을 받아 저장합니다.</p>
</li>
<li>
<p><strong>79~82</strong>:</p>
<p>cuDNN 을 사용 할 경우,  <code>placeholder</code> 의 <code>device</code> 를 <code>GPU</code> 로 설정한다.</p>
</li>
<li>
<p><strong>84~86</strong>:</p>
<p>신경망에 데이터셋(손글씨 이미지, 정답레이블)를 만들어 넣고 신경망의 Gradient 값을 초기화 하고 학습하는 과정을 반복한다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">// ======================= Test ======================</span>
<span class="kt">float</span> <span class="n">test_accuracy</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">test_avg_loss</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>

<span class="n">net</span><span class="o">-&gt;</span><span class="n">SetModeInference</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LOOP_FOR_TEST</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//dataset-&gt;CreateTestDataPair(BATCH);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*&gt;</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">=</span>  <span class="n">test_dataloader</span><span class="o">-&gt;</span><span class="n">GetDataFromGlobalBuffer</span><span class="p">();</span>
    <span class="c1">// printf(&quot;%d\r\n&quot;, temp-&gt;size());</span>

    <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x_t</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">temp</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">l_t</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">temp</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">delete</span> <span class="n">temp</span><span class="p">;</span>

<span class="cp">#ifdef __CUDNN__</span>
    <span class="n">x_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
    <span class="n">l_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
<span class="cp">#endif  </span><span class="c1">// __CUDNN__</span>

    <span class="n">net</span><span class="o">-&gt;</span><span class="n">FeedInputTensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_t</span><span class="p">,</span> <span class="n">l_t</span><span class="p">);</span>
    <span class="n">net</span><span class="o">-&gt;</span><span class="n">Test</span><span class="p">();</span>

    <span class="n">test_accuracy</span> <span class="o">+=</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">GetAccuracy</span><span class="p">();</span>
    <span class="n">test_avg_loss</span> <span class="o">+=</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">GetLoss</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">Test complete percentage is %d / %d -&gt; loss : %f, acc : %f&quot;</span><span class="p">,</span>
            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LOOP_FOR_TEST</span><span class="p">,</span>
            <span class="n">test_avg_loss</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">test_accuracy</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>106</strong>:</p>
<p>신경망을 테스트 모드(gradient 를 계산하지 않음)로 전환합니다.</p>
</li>
<li>
<p><strong>110~115</strong>:</p>
<p>MNIST 데이터셋으로부터 이미지와 정답레이블을 받아 저장합니다.</p>
</li>
<li>
<p><strong>122~123</strong>:</p>
<p>신경망에 데이터(image, label)를 입력하고 테스트를 진행합니다.  </p>
</li>
<li>
<p><strong>125~126</strong>:</p>
<p>정확도와 손실을 측정한다.</p>
</li>
</ul>
<hr />
<h2 id="tutorials-tutorialsimagenet-resnet">Tutorials <code>tutorials/ImageNet</code> (ResNet)<a class="headerlink" href="#tutorials-tutorialsimagenet-resnet" title="Permanent link">&para;</a></h2>
<p><code>tutorials/ImageNet</code> 는 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 신경망 모델 예제입니다.</p>
<h3 id="tutorialsimagenetnetmy_resnethpp"><code>tutorials/ImageNet/net/my_Resnet.hpp</code><a class="headerlink" href="#tutorialsimagenetnetmy_resnethpp" title="Permanent link">&para;</a></h3>
<p><code>tutorials/ImageNet/net/my_Resnet.hpp</code> 는 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 에서 <strong>ResNet</strong> 으로 ImageNet 데이터셋을 학습하기 위한 인공신경망을 구성하는 예제입니다. ImageNet 튜토리얼의 신경망 모델은 다음과 같이 정의됩니다. </p>
<p><code>ResNet</code> 은 다음과 같은 여러 개의 <code>BasicBlock(residual block)</code> 을 적층시켜 구성됩니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/ImageNet/net/my_Resnet.hpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">BasicBlock</span> <span class="o">:</span>
    <span class="k">public</span> <span class="n">Module</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">BasicBlock</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pStride</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="n">pStride</span><span class="p">,</span> <span class="n">pName</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">BasicBlock</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pStride</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">pInput</span><span class="p">);</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">remember</span> <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>
        <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span>      <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>

        <span class="c1">// 1</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pStride</span><span class="p">,</span> <span class="n">pStride</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;BasicBlock_Conv1&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;BasicBlock_BN1&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;BasicBlock_Relu1&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>

        <span class="c1">// 2</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;BasicBlock_Conv2&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;BasicBlock_BN2&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="c1">// out = new Relu&lt;DTYPE&gt;(out, &quot;BasicBlock_Relu2&quot; + pName);</span>

        <span class="c1">// ShortCut</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">pStride</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">pNumInputChannel</span> <span class="o">!=</span> <span class="n">pNumOutputChannel</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">remember</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">remember</span><span class="p">,</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pStride</span><span class="p">,</span> <span class="n">pStride</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;BasicBlock_Conv3_Shortcut&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
            <span class="n">remember</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">remember</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;BasicBlock_BN3_Shortcut&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
            <span class="c1">// remember = new Relu&lt;DTYPE&gt;(remember, &quot;BasicBlock_Relu3_Shortcut&quot; + pName);</span>
        <span class="p">}</span>

        <span class="c1">// Add (for skip Connection)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Addall</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">remember</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s">&quot;ResNet_Skip_Add&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="c1">// out = new Addall&lt;DTYPE&gt;(remember, out, &quot;ResNet_Skip_Add&quot;);</span>

        <span class="c1">// Last Relu</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;BasicBlock_Relu3&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>20~32</strong>:</p>
<p><code>BasicBlock</code> 은 <strong>Convolution layer</strong>, <strong>BatchNormailze layer</strong>, <strong>Relu</strong> 로 이루어진 2개의 layer와 <strong>skip connection(Short cut)</strong> 으로 이루어집니다.</p>
</li>
<li>
<p><strong>37</strong>:</p>
<p><strong>skip connection</strong> 은 <code>Addall</code> <code>Operator</code> 로 구현됩니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">ResNet</span> <span class="o">:</span>
    <span class="k">public</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">m_numInputChannel</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">ResNet</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock4</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="n">pNumOfBlock4</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">ResNet</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock4</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">);</span>

        <span class="n">m_numInputChannel</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>

        <span class="c1">// ReShape</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReShape</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="s">&quot;ReShape&quot;</span><span class="p">);</span>
        <span class="c1">// out = new BatchNormalizeLayer&lt;DTYPE&gt;(out, TRUE, &quot;BN0&quot;);</span>

        <span class="c1">// 1</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;Conv&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;BN0&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Relu0&quot;</span><span class="p">);</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Maxpooling2D</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;MaxPool_2&quot;</span><span class="p">);</span>
        <span class="c1">// out = new BatchNormalizeLayer&lt;DTYPE&gt;(out, TRUE, &quot;BN1&quot;);</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Block1&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Block2&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Block3&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Block4&quot;</span><span class="p">);</span>

        <span class="c1">// out = new BatchNormalizeLayer&lt;DTYPE&gt;(out, TRUE, &quot;BN1&quot;);</span>
        <span class="c1">// out = new Relu&lt;DTYPE&gt;(out, &quot;Relu1&quot;);</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GlobalAvaragePooling2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Avg Pooling&quot;</span><span class="p">);</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReShape</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="s">&quot;ReShape&quot;</span><span class="p">);</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;Classification&quot;</span><span class="p">);</span>
        <span class="c1">// out = new BatchNormalizeLayer &lt; DTYPE &gt; (out, FALSE, &quot;BN0&quot;);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

        <span class="c1">// ======================= Select LossFunction Function ===================</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetLossFunction</span><span class="p">(</span><span class="k">new</span> <span class="n">SoftmaxCrossEntropy</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="s">&quot;SCE&quot;</span><span class="p">));</span>
        <span class="c1">// SetLossFunction(new MSE&lt;float&gt;(out, label, &quot;MSE&quot;));</span>

        <span class="c1">// ======================= Select Optimizer ===================</span>
        <span class="c1">// this-&gt;SetOptimizer(new GradientDescentOptimizer&lt;float&gt;(this-&gt;GetParameter(), 0.1, 0.9, 5e-4, MINIMIZE));</span>
        <span class="c1">// this-&gt;SetOptimizer(new GradientDescentOptimizer&lt;float&gt;(this-&gt;GetParameter(), 0.001, MINIMIZE));</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetOptimizer</span><span class="p">(</span><span class="k">new</span> <span class="n">AdamOptimizer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetParameter</span><span class="p">(),</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mf">1e-08</span><span class="p">,</span> <span class="mf">5e-4</span><span class="p">,</span> <span class="n">MINIMIZE</span><span class="p">));</span>

        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;*</span> <span class="n">MakeLayer</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfChannel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pStride</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pNumOfBlock</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">pInput</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">pBlockType</span> <span class="o">==</span> <span class="s">&quot;BasicBlock&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pNumOfBlock</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>

            <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicBlock</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">pNumOfChannel</span><span class="p">,</span> <span class="n">pStride</span><span class="p">,</span> <span class="n">pName</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">pNumOutputChannel</span> <span class="o">=</span> <span class="n">pNumOfChannel</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pNumOfBlock</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicBlock</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pName</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">m_numInputChannel</span> <span class="o">=</span> <span class="n">pNumOutputChannel</span><span class="p">;</span>

            <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">pBlockType</span> <span class="o">==</span> <span class="s">&quot;Bottleneck&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pNumOfBlock</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>73~83</strong>:</p>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 의 <code>ResNet</code> 튜토리얼의 인공 신경망은 <strong>Conv</strong>, <strong>BatchNorm</strong> 등의 <code>Operator</code> 들과 사전에 정의한 4개의 <code>BasicBlock</code> 으로 모델을 구성합니다.</p>
</li>
<li>
<p><strong>98~104</strong>:</p>
<p><code>SetLossFunction</code> 과 <code>SetOptimizer</code> 를 이용해 손실함수와 <code>Optimizer</code> 를 정의합니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>131
132
133
134
135
136
137</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;*</span> <span class="n">Resnet18</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ResNet</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="s">&quot;BasicBlock&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;*</span> <span class="n">Resnet34</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ResNet</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="s">&quot;BasicBlock&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>131~137</strong> </p>
<p><code>ResNet</code> 의 종류는 <code>BasicBlock</code> 내부의 채널 수를 다르게 함으로써 나누어집니다.</p>
</li>
</ul>
<h3 id="tutorialsimagenetmaincpp"><code>tutorials/ImageNet/main.cpp</code><a class="headerlink" href="#tutorialsimagenetmaincpp" title="Permanent link">&para;</a></h3>
<p><code>tutorials/ImageNet/main.cpp</code> 은 </p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/ImageNet/main.cpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="c1">// create input, label data placeholder -&gt; Tensorholder</span>
    <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span>     <span class="o">=</span> <span class="k">new</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">150528</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">);</span>
    <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">);</span>

    <span class="c1">// ======================= Select net ===================</span>
    <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">net</span> <span class="o">=</span> <span class="n">Resnet18</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">NUMBER_OF_CLASS</span><span class="p">);</span>
    <span class="c1">// NeuralNetwork&lt;float&gt; *net = Resnet34&lt;float&gt;(x, label, NUMBER_OF_CLASS);</span>
    <span class="c1">// NeuralNetwork&lt;float&gt; *net = DenseNetLite&lt;float&gt;(x, label, NUMBER_OF_CLASS);</span>
    <span class="n">net</span><span class="o">-&gt;</span><span class="n">PrintGraphInformation</span><span class="p">();</span>

    <span class="c1">// ======================= Prepare Data ===================</span>
    <span class="n">ImageNetDataReader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">train_data_reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ImageNetDataReader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">BATCH</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
    <span class="n">train_data_reader</span><span class="o">-&gt;</span><span class="n">UseNormalization</span><span class="p">(</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span><span class="p">);</span>
    <span class="n">train_data_reader</span><span class="o">-&gt;</span><span class="n">UseRandomHorizontalFlip</span><span class="p">();</span>
    <span class="c1">// train_data_reader-&gt;UseRandomVerticalFlip();</span>

    <span class="n">ImageNetDataReader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">test_data_reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ImageNetDataReader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">BATCH</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
    <span class="n">test_data_reader</span><span class="o">-&gt;</span><span class="n">UseNormalization</span><span class="p">(</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stddev</span><span class="p">);</span>

    <span class="n">train_data_reader</span><span class="o">-&gt;</span><span class="n">StartProduce</span><span class="p">();</span>
    <span class="n">test_data_reader</span><span class="o">-&gt;</span><span class="n">StartProduce</span><span class="p">();</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>21~23</strong>:</p>
<p>데이터 placeholder 를 만든다.</p>
</li>
<li>
<p><strong>26</strong>:</p>
<p>사전에 정의된 인공신경망을 생성한다.</p>
</li>
<li>
<p><strong>32~34</strong>:</p>
<p><code>ImageNet</code> 데이터는 <strong>random crop</strong>, <strong>normalization</strong>, <strong>random Filp</strong> 과정을 거쳐 전처리 된다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>        <span class="c1">// ======================= Train =======================</span>
        <span class="p">...</span>
        <span class="n">net</span><span class="o">-&gt;</span><span class="n">SetModeTrain</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">LOOP_FOR_TRAIN</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">train_data_reader</span><span class="o">-&gt;</span><span class="n">GetDataFromBuffer</span><span class="p">();</span>

    <span class="cp">#ifdef __CUDNN__</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>  
            <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
    <span class="cp">#endif  </span><span class="c1">// __CUDNN__</span>
            <span class="n">net</span><span class="o">-&gt;</span><span class="n">FeedInputTensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
            <span class="k">delete</span> <span class="n">data</span><span class="p">;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
            <span class="n">net</span><span class="o">-&gt;</span><span class="n">ResetParameterGradient</span><span class="p">();</span>
            <span class="n">net</span><span class="o">-&gt;</span><span class="n">Train</span><span class="p">();</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>111~117</strong>:</p>
<p>전처리된 데이터를 버퍼로부터 가져와 신경망에 넣는다.</p>
</li>
<li>
<p><strong>120~121</strong>:</p>
<p>Gradient를 초기화 한 뒤 학습하는 과정을 반복한다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">// ======================= Test ======================</span>
<span class="p">...</span>
<span class="n">net</span><span class="o">-&gt;</span><span class="n">SetModeInference</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LOOP_FOR_TEST</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">test_data_reader</span><span class="o">-&gt;</span><span class="n">GetDataFromBuffer</span><span class="p">();</span>

<span class="cp">#ifdef __CUDNN__</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>  <span class="c1">// 異뷀썑 ?먮룞???꾩슂</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
<span class="cp">#endif  </span><span class="c1">// __CUDNN__</span>

    <span class="n">net</span><span class="o">-&gt;</span><span class="n">FeedInputTensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">delete</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">net</span><span class="o">-&gt;</span><span class="n">Test</span><span class="p">();</span>

    <span class="n">test_avg_accuracy</span>      <span class="o">+=</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">GetAccuracy</span><span class="p">(</span><span class="n">NUMBER_OF_CLASS</span><span class="p">);</span>
    <span class="n">test_avg_top5_accuracy</span> <span class="o">+=</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">GetTop5Accuracy</span><span class="p">(</span><span class="n">NUMBER_OF_CLASS</span><span class="p">);</span>
    <span class="n">test_avg_loss</span>          <span class="o">+=</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">GetLoss</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">%d / %d -&gt; avg_loss : %0.4f, avg_acc : %0.4f, avg_top5_acc : %0.4f&quot;</span>  <span class="cm">/*(ExcuteTime : %f)*/</span><span class="p">,</span>
            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LOOP_FOR_TEST</span><span class="p">,</span>
            <span class="n">test_avg_loss</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">test_avg_accuracy</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">test_avg_top5_accuracy</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>157</strong>:</p>
<p>신경망을 inference 모드로 전환 한다. </p>
</li>
<li>
<p><strong>160~170</strong>:</p>
<p>전처리된 데이터를 버퍼로부터 가져와 신경망에 넣어 정확도와 손실을 측정한다. </p>
</li>
<li>
<p><strong>172~181</strong>:</p>
<p>정확도와 손실을 출력한다. </p>
</li>
</ul>
<hr />
<h2 id="tutorials-tutorialsimagenet-densenet">Tutorials <code>tutorials/ImageNet</code> (DenseNet)<a class="headerlink" href="#tutorials-tutorialsimagenet-densenet" title="Permanent link">&para;</a></h2>
<p><code>tutorials/ImageNet</code> 는 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 신경망 모델 예제입니다.</p>
<h3 id="tutorialsimagenetnetmy_densenethpp"><code>tutorials/ImageNet/net/my_Densenet.hpp</code><a class="headerlink" href="#tutorialsimagenetnetmy_densenethpp" title="Permanent link">&para;</a></h3>
<p><code>tutorials/ImageNet/net/my_Densenet.hpp</code> 는 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 에서 <strong>DenseNet</strong> 으로 ImageNet 데이터셋을 학습하기 위한 인공신경망을 구성하는 예제입니다. 신경망 모델은 다음과 같이 정의됩니다. </p>
<p><code>DenseNet</code> 은 다음과 같은 여러 개의 <code>DenseNetBlock</code> 을 적층시켜 구성됩니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/ImageNet/net/my_Densenet.hpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">DenseNetBlock</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Module</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">DenseNetBlock</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">:</span> <span class="n">Module</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">pName</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="n">pName</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">DenseNetBlock</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">pInput</span><span class="p">);</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">remember</span> <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>
        <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span>      <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>

        <span class="c1">// 1</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock_BN1&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock_Relu1&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock_Conv1&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>

        <span class="c1">// 2</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock_BN2&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock_Relu2&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock_Conv2&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>

        <span class="c1">// Concat</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcatenateChannelWise</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">remember</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock_ConCat&quot;</span><span class="p">);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>20~41</strong>:</p>
<p><code>DenseNet</code> 은 이와 같이 정의됩니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Transition</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Module</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Transition</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">:</span> <span class="n">Module</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">pName</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="n">pName</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">Transition</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">pInput</span><span class="p">);</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>

        <span class="c1">// 1</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;Transition_BN&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Transition_Relu&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pNumInputChannel</span><span class="p">,</span> <span class="n">pNumOutputChannel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;Transition_Conv&quot;</span> <span class="o">+</span> <span class="n">pName</span><span class="p">);</span>

        <span class="c1">// Avg Pooling</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AvaragePooling2D</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;AVG&quot;</span><span class="p">);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>40~66</strong>:</p>
<p><code>DenseNetBlock</code> 을 연결하는 <code>Transition</code> 은 위와 같이 정의됩니다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">DenseNet</span> <span class="o">:</span> <span class="k">public</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">m_numInputChannel</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">m_numOutputChannel</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">m_growthRate</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">m_reduction</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">DenseNet</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock4</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pGrowthRate</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="kt">float</span> <span class="n">pReduction</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="n">pNumOfBlock4</span><span class="p">,</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="n">pReduction</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">DenseNet</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock4</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pGrowthRate</span><span class="p">,</span> <span class="kt">float</span> <span class="n">pReduction</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">);</span>

        <span class="n">m_numInputChannel</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pGrowthRate</span><span class="p">;</span>
        <span class="n">m_growthRate</span>      <span class="o">=</span> <span class="n">pGrowthRate</span><span class="p">;</span>
        <span class="n">m_reduction</span>       <span class="o">=</span> <span class="n">pReduction</span><span class="p">;</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>

        <span class="c1">// ReShape</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReShape</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="s">&quot;ReShape&quot;</span><span class="p">);</span>
        <span class="c1">// out = new BatchNormalizeLayer&lt;DTYPE&gt;(out, TRUE, &quot;BN0&quot;);</span>

        <span class="c1">// 1</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConvolutionLayer2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;Conv&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;BN0&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Relu</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Relu0&quot;</span><span class="p">);</span>

        <span class="n">out</span>                <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Block1&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span> <span class="o">+=</span> <span class="n">pNumOfBlock1</span> <span class="o">*</span> <span class="n">m_growthRate</span><span class="p">;</span>
        <span class="n">m_numOutputChannel</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">floor</span><span class="p">(</span><span class="n">m_numInputChannel</span> <span class="o">*</span> <span class="n">m_reduction</span><span class="p">));</span>
        <span class="n">out</span>                <span class="o">=</span> <span class="k">new</span> <span class="n">Transition</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">m_numOutputChannel</span><span class="p">,</span> <span class="s">&quot;Trans1&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span>  <span class="o">=</span> <span class="n">m_numOutputChannel</span><span class="p">;</span>

        <span class="n">out</span>                <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numOutputChannel</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Block2&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span> <span class="o">+=</span> <span class="n">pNumOfBlock2</span> <span class="o">*</span> <span class="n">m_growthRate</span><span class="p">;</span>
        <span class="n">m_numOutputChannel</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">floor</span><span class="p">(</span><span class="n">m_numInputChannel</span> <span class="o">*</span> <span class="n">m_reduction</span><span class="p">));</span>
        <span class="n">out</span>                <span class="o">=</span> <span class="k">new</span> <span class="n">Transition</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">m_numOutputChannel</span><span class="p">,</span> <span class="s">&quot;Trans2&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span>  <span class="o">=</span> <span class="n">m_numOutputChannel</span><span class="p">;</span>

        <span class="n">out</span>                <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numOutputChannel</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Block3&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span> <span class="o">+=</span> <span class="n">pNumOfBlock3</span> <span class="o">*</span> <span class="n">m_growthRate</span><span class="p">;</span>
        <span class="n">m_numOutputChannel</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">floor</span><span class="p">(</span><span class="n">m_numInputChannel</span> <span class="o">*</span> <span class="n">m_reduction</span><span class="p">));</span>
        <span class="n">out</span>                <span class="o">=</span> <span class="k">new</span> <span class="n">Transition</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">m_numOutputChannel</span><span class="p">,</span> <span class="s">&quot;Trans3&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span>  <span class="o">=</span> <span class="n">m_numOutputChannel</span><span class="p">;</span>

        <span class="n">out</span>                <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MakeLayer</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numOutputChannel</span><span class="p">,</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="n">pNumOfBlock4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Block4&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span> <span class="o">+=</span> <span class="n">pNumOfBlock4</span> <span class="o">*</span> <span class="n">m_growthRate</span><span class="p">;</span>
        <span class="n">m_numOutputChannel</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">floor</span><span class="p">(</span><span class="n">m_numInputChannel</span> <span class="o">*</span> <span class="n">m_reduction</span><span class="p">));</span>
        <span class="n">out</span>                <span class="o">=</span> <span class="k">new</span> <span class="n">Transition</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">m_numOutputChannel</span><span class="p">,</span> <span class="s">&quot;Trans4&quot;</span><span class="p">);</span>
        <span class="n">m_numInputChannel</span>  <span class="o">=</span> <span class="n">m_numOutputChannel</span><span class="p">;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GlobalAvaragePooling2D</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Avg Pooling&quot;</span><span class="p">);</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReShape</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="s">&quot;ReShape&quot;</span><span class="p">);</span>

        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">m_numInputChannel</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;Classification&quot;</span><span class="p">);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>

        <span class="c1">// ======================= Select LossFunction Function ===================</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetLossFunction</span><span class="p">(</span><span class="k">new</span> <span class="n">SoftmaxCrossEntropy</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="s">&quot;SCE&quot;</span><span class="p">));</span>
        <span class="c1">// SetLossFunction(new MSE&lt;float&gt;(out, label, &quot;MSE&quot;));</span>

        <span class="c1">// ======================= Select Optimizer ===================</span>
        <span class="c1">// this-&gt;SetOptimizer(new GradientDescentOptimizer&lt;float&gt;(this-&gt;GetParameter(), 0.000001, 0.9, 5e-4, MINIMIZE));</span>
        <span class="c1">// this-&gt;SetOptimizer(new GradientDescentOptimizer&lt;float&gt;(this-&gt;GetParameter(), 0.001, MINIMIZE));</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetOptimizer</span><span class="p">(</span><span class="k">new</span> <span class="n">AdamOptimizer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetParameter</span><span class="p">(),</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mf">1e-08</span><span class="p">,</span> <span class="mf">5e-4</span><span class="p">,</span> <span class="n">MINIMIZE</span><span class="p">));</span>

        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;*</span> <span class="n">MakeLayer</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfChannel</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pBlockType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfBlock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pStride</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pName</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pNumOfBlock</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">pInput</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">pBlockType</span> <span class="o">==</span> <span class="s">&quot;DenseNetBlock&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pNumOfBlock</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Operator</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="n">pInput</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pNumOfBlock</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">out</span>            <span class="o">=</span> <span class="k">new</span> <span class="n">DenseNetBlock</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">pNumOfChannel</span><span class="p">,</span> <span class="n">m_growthRate</span><span class="p">,</span> <span class="n">pName</span><span class="p">);</span>
                <span class="n">pNumOfChannel</span> <span class="o">+=</span> <span class="n">m_growthRate</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">pBlockType</span> <span class="o">==</span> <span class="s">&quot;Bottleneck&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pNumOfBlock</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;*</span> <span class="n">DenseNet121</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">DenseNet</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;*</span> <span class="n">DenseNetLite</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pInput</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">pLabel</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pNumOfClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">DenseNet</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">pInput</span><span class="p">,</span> <span class="n">pLabel</span><span class="p">,</span> <span class="s">&quot;DenseNetBlock&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">pNumOfClass</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>92~121</strong>:</p>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 튜토리얼의 <code>DenseNet</code> 은 <span class="arithmatex">\(4\)</span> 개의 <code>DenseNetBlock</code> 과 각각의 <code>DenseNetBlock</code> 사이를 잇는 4개의 <code>Transition</code> 으로 정의됩니다.</p>
</li>
</ul>
<hr />
<h2 id="tutorials-tutorialsganvanillagan">Tutorials <code>tutorials/GAN/VanillaGAN</code><a class="headerlink" href="#tutorials-tutorialsganvanillagan" title="Permanent link">&para;</a></h2>
<p><code>tutorials/GAN/VanillaGAN</code> 은 <a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 신경망 모델 예제입니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 의 <code>GAN</code> 은 <code>Generator</code> 와 <code>Discriminator</code> 를 각각 구성한다.</p>
<h3 id="tutorialsganvanillagannetmy_generatorhpp"><code>tutorials/GAN/VanillaGAN/net/my_Generator.hpp</code><a class="headerlink" href="#tutorialsganvanillagannetmy_generatorhpp" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 의 <code>GAN</code> 튜토리얼의 <code>Generator</code> 는 다음과 같이 정의됩니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/GAN/VanillaGAN/net/my_Generator.hpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">my_Generator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">my_Generator</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">z</span><span class="p">){</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">my_Generator</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">z</span><span class="p">){</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>

        <span class="c1">// ======================= layer 1 ======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;G_L1&quot;</span><span class="p">);</span>

        <span class="c1">// ======================= layer 2 ======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;G_L2&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;G_BN1&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LRelu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s">&quot;G_LRelu1&quot;</span><span class="p">);</span>
        <span class="c1">// out = new Relu&lt;float&gt;(out, &quot;G_Relu1&quot;);</span>

        <span class="c1">// ======================= layer 3 ======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;G_L3&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;G_BN2&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LRelu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s">&quot;G_LRelu2&quot;</span><span class="p">);</span>
        <span class="c1">// out = new Relu&lt;float&gt;(out, &quot;G_Relu2&quot;);</span>

        <span class="c1">// ======================= layer 4 ======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;G_L4&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchNormalizeLayer</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="s">&quot;G_BN3&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LRelu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s">&quot;G_LRelu3&quot;</span><span class="p">);</span>
        <span class="c1">// out = new Relu&lt;float&gt;(out, &quot;G_Relu3&quot;);</span>

        <span class="c1">// ======================= layer 5 ====================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">784</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;G_L5&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tanh</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;Tanh&quot;</span><span class="p">);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<h3 id="tutorialsganvanillagannetmy_discriminatorhpp"><code>tutorials/GAN/VanillaGAN/net/my_Discriminator.hpp</code><a class="headerlink" href="#tutorialsganvanillagannetmy_discriminatorhpp" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 의 <code>GAN</code> 튜토리얼의 <code>Discriminator</code> 는 다음과 같이 정의됩니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/GAN/VanillaGAN/net/my_Discriminator.hpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">my_Discriminator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">NeuralNetwork</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">my_Discriminator</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span><span class="p">){</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">my_Discriminator</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Operator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span><span class="p">){</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

        <span class="n">Operator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>

        <span class="c1">// ======================= layer 1 ======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">784</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;D_L1&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LRelu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s">&quot;D_LRelu1&quot;</span><span class="p">);</span>
        <span class="c1">// out = new Relu&lt;float&gt;(out, &quot;D_Relu1&quot;);</span>

       <span class="c1">// ======================= layer 2 ======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;D_L2&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LRelu</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s">&quot;D_LRelu2&quot;</span><span class="p">);</span>
        <span class="c1">// out = new Relu&lt;float&gt;(out, &quot;D_Relu2&quot;);</span>

        <span class="c1">// ======================= layer 3 ======================</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Linear</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">,</span> <span class="s">&quot;D_L3&quot;</span><span class="p">);</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sigmoid</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;D_Sigmoid&quot;</span><span class="p">);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<h3 id="tutorialsganvanillagannetmy_ganhpp"><code>tutorials/GAN/VanillaGAN/net/my_GAN.hpp</code><a class="headerlink" href="#tutorialsganvanillagannetmy_ganhpp" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 튜토리얼에서 <code>Generator</code> 와 <code>Discriminator</code> 의 학습을 제어하는 <code>GAN</code> 은 다음과 같이 정의됩니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/GAN/VanillaGAN/net/my_GAN.hpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DTYPE</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">my_GAN</span> <span class="o">:</span> <span class="k">public</span> <span class="n">GAN</span><span class="o">&lt;</span><span class="n">DTYPE</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">my_GAN</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">z</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">label</span><span class="p">){</span>
        <span class="n">Alloc</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="o">~</span><span class="n">my_GAN</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">z</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">label</span><span class="p">){</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetInput</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetGenerator</span><span class="p">(</span><span class="k">new</span> <span class="n">my_Generator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">z</span><span class="p">));</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetSwitch</span><span class="p">(</span><span class="k">new</span> <span class="n">Switch</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetGenerator</span><span class="p">(),</span> <span class="n">x</span><span class="p">));</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetDiscriminator</span><span class="p">(</span><span class="k">new</span> <span class="n">my_Discriminator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetSwitch</span><span class="p">()));</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">AnalyzeGraph</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetDiscriminator</span><span class="p">());</span>

        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

        <span class="c1">// ======================= Select LossFunction ===================</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetGANLossFunctions</span><span class="p">(</span><span class="k">new</span> <span class="n">VanillaGANGeneratorLoss</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetDiscriminator</span><span class="p">(),</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">GetLabel</span><span class="p">(),</span> <span class="s">&quot;VanillaGANGeneratorLoss&quot;</span><span class="p">),</span> <span class="k">new</span> <span class="n">VanillaGANDiscriminatorLoss</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetDiscriminator</span><span class="p">(),</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">GetLabel</span><span class="p">(),</span> <span class="s">&quot;VanillaGANDiscriminatorLoss&quot;</span><span class="p">));</span>

        <span class="c1">// ======================= Select Optimizer ===================</span>
        <span class="c1">// this-&gt;SetGANOptimizers(new GradientDescentOptimizer&lt;float&gt;(this-&gt;GetGenerator()-&gt;GetParameter(), 0.000001, MINIMIZE), new GradientDescentOptimizer&lt;float&gt;(this-&gt;GetDiscriminator()-&gt;GetParameter(), 0.000001, MAXIMIZE));</span>
        <span class="c1">// this-&gt;SetGANOptimizers(new RMSPropOptimizer&lt;float&gt;(this-&gt;GetGenerator()-&gt;GetParameter(), 0.0001, 0.9, 1e-08, FALSE, MINIMIZE), new RMSPropOptimizer&lt;float&gt;(this-&gt;GetDiscriminator()-&gt;GetParameter(), 0.0001, 0.9, 1e-08, FALSE, MAXIMIZE));</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetGANOptimizers</span><span class="p">(</span><span class="k">new</span> <span class="n">AdamOptimizer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetGenerator</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetParameter</span><span class="p">(),</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mf">1e-08</span><span class="p">,</span> <span class="n">MINIMIZE</span><span class="p">),</span> <span class="k">new</span> <span class="n">AdamOptimizer</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">GetDiscriminator</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetParameter</span><span class="p">(),</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mf">1e-08</span><span class="p">,</span> <span class="n">MINIMIZE</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
</td></tr></table>

<h3 id="tutorialsganvanillaganmaincpp"><code>tutorials/GAN/VanillaGAN/main.cpp</code><a class="headerlink" href="#tutorialsganvanillaganmaincpp" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/WICWIU/WICWIU"><strong>WICWIU</strong></a> 튜토리얼에서 사전에 정의된 <code>GAN</code> 을 사용하는 <code>main</code> 함수는 다음과 같이 정의됩니다.</p>
<p><a href="https://github.com/WICWIU/WICWIU/blob/master/tutorials/GAN/VanillaGAN/main.cpp"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 3a2 2 0 012-2h9.982a2 2 0 011.414.586l4.018 4.018A2 2 0 0121 7.018V21a2 2 0 01-2 2H4.75a.75.75 0 010-1.5H19a.5.5 0 00.5-.5V8.5h-4a2 2 0 01-2-2v-4H5a.5.5 0 00-.5.5v6.25a.75.75 0 01-1.5 0V3zm12-.5v4a.5.5 0 00.5.5h4a.5.5 0 00-.146-.336l-4.018-4.018A.5.5 0 0015 2.5z"/><path d="M4.53 12.24a.75.75 0 01-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 11-1.022 1.1l-3.23-3a.75.75 0 010-1.1l3.23-3a.75.75 0 011.06.04zm3.979 1.06a.75.75 0 111.02-1.1l3.231 3a.75.75 0 010 1.1l-3.23 3a.75.75 0 11-1.021-1.1l2.639-2.45-2.64-2.45z"/></svg></span> Source</a></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="c1">// create input, label data placeholder -&gt; Tensorholder</span>
    <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">z</span>     <span class="o">=</span> <span class="k">new</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s">&quot;z&quot;</span><span class="p">);</span>
    <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x</span>     <span class="o">=</span> <span class="k">new</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">784</span><span class="p">,</span> <span class="s">&quot;x&quot;</span><span class="p">);</span>
    <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">label</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Tensorholder</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">);</span>

    <span class="c1">// create NoiseGenrator</span>
    <span class="n">GaussianNoiseGenerator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">Gnoise</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GaussianNoiseGenerator</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">BATCH</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// ======================= Select net ===================</span>
    <span class="c1">// GAN&lt;float&gt; *net  = new my_BEGAN&lt;float&gt;(z, x, label);</span>
    <span class="n">GAN</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">net</span>  <span class="o">=</span> <span class="k">new</span> <span class="n">my_GAN</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
    <span class="c1">//net-&gt;Load(filename);</span>

    <span class="c1">// ======================= Prepare Data ===================</span>
    <span class="n">MNISTDataSet</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">CreateMNISTDataSet</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>16</strong>:</p>
<p><code>Generator</code> 의 입력으로 사용할 latent variable을 저장 할 변수를 생성한다.</p>
</li>
<li>
<p><strong>25</strong>:</p>
<p>사전에 정의한 <code>GAN</code> 클래스를 이용해 신경망을 생성한다.</p>
</li>
<li>
<p><strong>29</strong>:</p>
<p>MNIST 데이터셋을 저장 할 변수를 생성한다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">//Start make Noise</span>
<span class="n">Gnoise</span><span class="o">-&gt;</span><span class="n">StartProduce</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">EPOCH</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;EPOCH : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="c1">// ======================= Train =======================</span>
    <span class="kt">float</span> <span class="n">genLoss</span>  <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">discLoss</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>

    <span class="n">net</span><span class="o">-&gt;</span><span class="n">SetModeTrain</span><span class="p">();</span>
    <span class="n">startTime</span> <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">LOOP_FOR_TRAIN</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dataset</span><span class="o">-&gt;</span><span class="n">CreateTrainDataPair</span><span class="p">(</span><span class="n">BATCH</span><span class="p">);</span>

        <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">x_t</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">-&gt;</span><span class="n">GetTrainFeedImage</span><span class="p">();</span>
        <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">l_t</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">-&gt;</span><span class="n">GetTrainFeedLabel</span><span class="p">();</span>
        <span class="k">delete</span> <span class="n">l_t</span><span class="p">;</span>
        <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">z_t</span> <span class="o">=</span> <span class="n">Gnoise</span><span class="o">-&gt;</span><span class="n">GetNoiseFromBuffer</span><span class="p">();</span>

<span class="cp">#ifdef __CUDNN__</span>
        <span class="n">x_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
        <span class="n">z_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
<span class="cp">#endif  </span><span class="c1">// __CUDNN__</span>
        <span class="n">net</span><span class="o">-&gt;</span><span class="n">FeedInputTensor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">z_t</span><span class="p">,</span> <span class="n">x_t</span><span class="p">);</span>
        <span class="n">net</span><span class="o">-&gt;</span><span class="n">ResetParameterGradient</span><span class="p">();</span>
        <span class="n">net</span><span class="o">-&gt;</span><span class="n">TrainDiscriminator</span><span class="p">();</span>

        <span class="n">z_t</span> <span class="o">=</span> <span class="n">Gnoise</span><span class="o">-&gt;</span><span class="n">GetNoiseFromBuffer</span><span class="p">();</span>

<span class="cp">#ifdef __CUDNN__</span>
        <span class="n">z_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
<span class="cp">#endif  </span><span class="c1">// __CUDNN__</span>
        <span class="n">net</span><span class="o">-&gt;</span><span class="n">FeedInputTensor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">z_t</span><span class="p">);</span>
        <span class="n">net</span><span class="o">-&gt;</span><span class="n">ResetParameterGradient</span><span class="p">();</span>
        <span class="n">net</span><span class="o">-&gt;</span><span class="n">TrainGenerator</span><span class="p">();</span>

        <span class="k">if</span><span class="p">((</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">genLoss</span>  <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">GetGeneratorLossFunction</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetResult</span><span class="p">())[</span><span class="n">Index5D</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">GetGeneratorLossFunction</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetResult</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetShape</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)];</span>
            <span class="n">discLoss</span>  <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">GetDiscriminatorLossFunction</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetResult</span><span class="p">())[</span><span class="n">Index5D</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">GetDiscriminatorLossFunction</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetResult</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetShape</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)];</span>

            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">Train complete percentage is %d / %d -&gt; Generator Loss : %f, Discriminator Loss : %f&quot;</span><span class="p">,</span>
                    <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">LOOP_FOR_TRAIN</span><span class="p">,</span>
                    <span class="n">genLoss</span><span class="p">,</span>
                    <span class="n">discLoss</span><span class="p">);</span>
            <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>

            <span class="n">string</span> <span class="n">filePath</span>  <span class="o">=</span> <span class="s">&quot;trained/epoch&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.jpg&quot;</span><span class="p">;</span>
            <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cstr</span> <span class="o">=</span> <span class="n">filePath</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
            <span class="n">Tensor2Image</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">GetGenerator</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetResult</span><span class="p">(),</span> <span class="n">cstr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">endTime</span>            <span class="o">=</span> <span class="n">clock</span><span class="p">();</span>
    <span class="n">nProcessExcuteTime</span> <span class="o">=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">))</span> <span class="o">/</span> <span class="n">CLOCKS_PER_SEC</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">(excution time per epoch : %f)</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nProcessExcuteTime</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>60</strong>:</p>
<p>전처리된 데이터를 가져옵니다.</p>
</li>
<li>
<p><strong>63</strong>:</p>
<p>latent 변수를 가져옵니다.</p>
</li>
<li>
<p><strong>70~71</strong>:</p>
<p>Gradient 를 초기화하고 학습하는 과정을 반복합니다.</p>
</li>
<li>
<p><strong>95</strong> 행:</p>
<p><code>Generator</code> 에서 생성한 이미지를 일정 step마다 저장한다.</p>
</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">// =======================Test Generate(Save Generated Image)======================</span>
<span class="n">net</span><span class="o">-&gt;</span><span class="n">SetModeInference</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">LOOP_FOR_GENERATE</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Tensor</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">z_t</span> <span class="o">=</span> <span class="n">Gnoise</span><span class="o">-&gt;</span><span class="n">GetNoiseFromBuffer</span><span class="p">();</span>

<span class="cp">#ifdef __CUDNN__</span>
    <span class="n">z_t</span><span class="o">-&gt;</span><span class="n">SetDeviceGPU</span><span class="p">(</span><span class="n">GPUID</span><span class="p">);</span>
<span class="cp">#endif  </span><span class="c1">// __CUDNN__</span>

    <span class="n">net</span><span class="o">-&gt;</span><span class="n">FeedInputTensor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">z_t</span><span class="p">);</span>
    <span class="n">net</span><span class="o">-&gt;</span><span class="n">Generate</span><span class="p">();</span>

    <span class="n">string</span> <span class="n">filePath</span>  <span class="o">=</span> <span class="s">&quot;generated/epoch&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.jpg&quot;</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cstr</span> <span class="o">=</span> <span class="n">filePath</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
    <span class="n">Tensor2Image</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">GetGenerator</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">GetResult</span><span class="p">(),</span> <span class="n">cstr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">Generate complete percentage is %d / %d&quot;</span><span class="p">,</span>
            <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">LOOP_FOR_GENERATE</span><span class="p">);</span>
    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="n">net</span><span class="o">-&gt;</span><span class="n">Save</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

<ul>
<li>
<p><strong>106~127</strong>:</p>
<p><code>GAN</code> 에서는 정확도가 의미있는 것이 아니므로 테스트에서는 <code>Generator</code> 에서 이미지를 생성시킨 뒤 저장하는 과정을 반복한다.</p>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../learn/" title="3. WICWIU 로 학습하기" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  이전
                </span>
                3. WICWIU 로 학습하기
              </div>
            </div>
          </a>
        
        
          <a href="../../Git/git/" title="Collaborate with Git" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  다음
                </span>
                Collaborate with Git
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018-2020 HGU DL Lab
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/WICWIU" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.c3dc8c49.min.js"></script>
      <script src="../../../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\ud074\ub9bd\ubcf4\ub4dc\ub85c \ubcf5\uc0ac", "clipboard.copied": "\ud074\ub9bd\ubcf4\ub4dc\uc5d0 \ubcf5\uc0ac\ub428", "search.config.lang": "en", "search.config.pipeline": " ", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694", "search.result.none": "\uac80\uc0c9\uc5b4\uc640 \uc77c\uce58\ud558\ub294 \ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4", "search.result.one": "1\uac1c\uc758 \uc77c\uce58\ud558\ub294 \ubb38\uc11c", "search.result.other": "#\uac1c\uc758 \uc77c\uce58\ud558\ub294 \ubb38\uc11c"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
      
        <script src="../../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>